{"ast":null,"code":"import { RelationCountAttribute } from \"./RelationCountAttribute\";\nexport class RelationCountMetadataToAttributeTransformer {\n  // -------------------------------------------------------------------------\n  // Constructor\n  // -------------------------------------------------------------------------\n  constructor(expressionMap) {\n    this.expressionMap = expressionMap;\n  }\n  // -------------------------------------------------------------------------\n  // Public Methods\n  // -------------------------------------------------------------------------\n  transform() {\n    // by example:\n    // post has relation count:\n    // @RelationCount(post => post.categories) categoryCount\n    // category has relation count\n    // @RelationCount(category => category.images) imageCount\n    // we load post and join category\n    // we expect post.categoryCount and post.category.imageCount to have relation counts\n    // first create relation count attributes for all relation count metadatas of the main selected object (post from example)\n    if (this.expressionMap.mainAlias) {\n      this.expressionMap.mainAlias.metadata.relationCounts.forEach(relationCount => {\n        const attribute = this.metadataToAttribute(this.expressionMap.mainAlias.name, relationCount);\n        this.expressionMap.relationCountAttributes.push(attribute);\n      });\n    }\n    // second create relation count attributes for all relation count metadatas of all joined objects (category from example)\n    this.expressionMap.joinAttributes.forEach(join => {\n      // ensure this join has a metadata, because relation count can only work for real orm entities\n      if (!join.metadata || join.metadata.isJunction) return;\n      join.metadata.relationCounts.forEach(relationCount => {\n        const attribute = this.metadataToAttribute(join.alias.name, relationCount);\n        this.expressionMap.relationCountAttributes.push(attribute);\n      });\n    });\n  }\n  // -------------------------------------------------------------------------\n  // Private Methods\n  // -------------------------------------------------------------------------\n  metadataToAttribute(parentAliasName, relationCount) {\n    return new RelationCountAttribute(this.expressionMap, {\n      relationName: parentAliasName + \".\" + relationCount.relation.propertyName,\n      mapToProperty: parentAliasName + \".\" + relationCount.propertyName,\n      alias: relationCount.alias,\n      queryBuilderFactory: relationCount.queryBuilderFactory\n    });\n  }\n}","map":{"version":3,"names":["RelationCountAttribute","RelationCountMetadataToAttributeTransformer","constructor","expressionMap","transform","mainAlias","metadata","relationCounts","forEach","relationCount","attribute","metadataToAttribute","name","relationCountAttributes","push","joinAttributes","join","isJunction","alias","parentAliasName","relationName","relation","propertyName","mapToProperty","queryBuilderFactory"],"sources":["C:/Users/practicas/Downloads/angular/tresOnline/node_modules/typeorm/browser/query-builder/relation-count/RelationCountMetadataToAttributeTransformer.js"],"sourcesContent":["import { RelationCountAttribute } from \"./RelationCountAttribute\";\nexport class RelationCountMetadataToAttributeTransformer {\n    // -------------------------------------------------------------------------\n    // Constructor\n    // -------------------------------------------------------------------------\n    constructor(expressionMap) {\n        this.expressionMap = expressionMap;\n    }\n    // -------------------------------------------------------------------------\n    // Public Methods\n    // -------------------------------------------------------------------------\n    transform() {\n        // by example:\n        // post has relation count:\n        // @RelationCount(post => post.categories) categoryCount\n        // category has relation count\n        // @RelationCount(category => category.images) imageCount\n        // we load post and join category\n        // we expect post.categoryCount and post.category.imageCount to have relation counts\n        // first create relation count attributes for all relation count metadatas of the main selected object (post from example)\n        if (this.expressionMap.mainAlias) {\n            this.expressionMap.mainAlias.metadata.relationCounts.forEach((relationCount) => {\n                const attribute = this.metadataToAttribute(this.expressionMap.mainAlias.name, relationCount);\n                this.expressionMap.relationCountAttributes.push(attribute);\n            });\n        }\n        // second create relation count attributes for all relation count metadatas of all joined objects (category from example)\n        this.expressionMap.joinAttributes.forEach((join) => {\n            // ensure this join has a metadata, because relation count can only work for real orm entities\n            if (!join.metadata || join.metadata.isJunction)\n                return;\n            join.metadata.relationCounts.forEach((relationCount) => {\n                const attribute = this.metadataToAttribute(join.alias.name, relationCount);\n                this.expressionMap.relationCountAttributes.push(attribute);\n            });\n        });\n    }\n    // -------------------------------------------------------------------------\n    // Private Methods\n    // -------------------------------------------------------------------------\n    metadataToAttribute(parentAliasName, relationCount) {\n        return new RelationCountAttribute(this.expressionMap, {\n            relationName: parentAliasName + \".\" + relationCount.relation.propertyName,\n            mapToProperty: parentAliasName + \".\" + relationCount.propertyName,\n            alias: relationCount.alias,\n            queryBuilderFactory: relationCount.queryBuilderFactory,\n        });\n    }\n}\n\n"],"mappings":"AAAA,SAASA,sBAAsB,QAAQ,0BAA0B;AACjE,OAAO,MAAMC,2CAA2C,CAAC;EACrD;EACA;EACA;EACAC,WAAWA,CAACC,aAAa,EAAE;IACvB,IAAI,CAACA,aAAa,GAAGA,aAAa;EACtC;EACA;EACA;EACA;EACAC,SAASA,CAAA,EAAG;IACR;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA,IAAI,IAAI,CAACD,aAAa,CAACE,SAAS,EAAE;MAC9B,IAAI,CAACF,aAAa,CAACE,SAAS,CAACC,QAAQ,CAACC,cAAc,CAACC,OAAO,CAAEC,aAAa,IAAK;QAC5E,MAAMC,SAAS,GAAG,IAAI,CAACC,mBAAmB,CAAC,IAAI,CAACR,aAAa,CAACE,SAAS,CAACO,IAAI,EAAEH,aAAa,CAAC;QAC5F,IAAI,CAACN,aAAa,CAACU,uBAAuB,CAACC,IAAI,CAACJ,SAAS,CAAC;MAC9D,CAAC,CAAC;IACN;IACA;IACA,IAAI,CAACP,aAAa,CAACY,cAAc,CAACP,OAAO,CAAEQ,IAAI,IAAK;MAChD;MACA,IAAI,CAACA,IAAI,CAACV,QAAQ,IAAIU,IAAI,CAACV,QAAQ,CAACW,UAAU,EAC1C;MACJD,IAAI,CAACV,QAAQ,CAACC,cAAc,CAACC,OAAO,CAAEC,aAAa,IAAK;QACpD,MAAMC,SAAS,GAAG,IAAI,CAACC,mBAAmB,CAACK,IAAI,CAACE,KAAK,CAACN,IAAI,EAAEH,aAAa,CAAC;QAC1E,IAAI,CAACN,aAAa,CAACU,uBAAuB,CAACC,IAAI,CAACJ,SAAS,CAAC;MAC9D,CAAC,CAAC;IACN,CAAC,CAAC;EACN;EACA;EACA;EACA;EACAC,mBAAmBA,CAACQ,eAAe,EAAEV,aAAa,EAAE;IAChD,OAAO,IAAIT,sBAAsB,CAAC,IAAI,CAACG,aAAa,EAAE;MAClDiB,YAAY,EAAED,eAAe,GAAG,GAAG,GAAGV,aAAa,CAACY,QAAQ,CAACC,YAAY;MACzEC,aAAa,EAAEJ,eAAe,GAAG,GAAG,GAAGV,aAAa,CAACa,YAAY;MACjEJ,KAAK,EAAET,aAAa,CAACS,KAAK;MAC1BM,mBAAmB,EAAEf,aAAa,CAACe;IACvC,CAAC,CAAC;EACN;AACJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}